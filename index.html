<!DOCTYPE html>
<html lang="ja">

<head>
    <title>sgnjoy</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="bmstable" content="header.json" />
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        body {
            background-color: #121212;
            color: #e0e0e0;
        }

        .navbar {
            background-color: #1f1f1f !important;
        }

        .alert-success {
            background-color: #0d2b78;
            color: #ffffff;
            border-color: #2f6fad;
        }

        .table-dark {
            background-color: #181818 !important;
            color: #e0e0e0;
        }

        .table-dark thead {
            background-color: #222 !important;
        }

        .table-striped > tbody > tr:nth-of-type(odd) {
            background-color: #1d1d1d;
        }

        .table-hover tbody tr:hover {
            background-color: #262f3a;
        }

        .table-dark td,
        .table-dark th {
            border-color: #2a2a2a;
        }

        /* レベル区切り専用 */
        .level-sep {
            background-color: #1f1f1f !important;
            border-top: 2px solid #2f6fad;
            text-align: center;
            font-weight: bold;
        }

        a {
            color: #66b3ff;
        }

        a:hover {
            color: #9fd0ff;
        }
        .comment-tag {
    color: #ff3b3b;
    font-weight: bold;
}
    </style>
</head>

<body>
    <header class="mb-3">
        <nav class="navbar navbar-dark">
            <div class="container-fluid">
                <span class="navbar-brand mb-0 h1">sgnjoy</span>
            </div>
        </nav>
    </header>

    <div class="container">

        <div class="alert alert-success mb-3" role="alert">
            <p>obj:sgn名義で作った差分をまとめた難易度表です</p>
            <p>急に難易度が変わったりすることがありますがご了承ください</p>
            <p>一応イージー難易度順に上から並べています</p>
            <p>レベル設定はかなりガバガバなので注意</p>
            <hr>
            <p class="mb-0">sg0 = st0 ／ sg-1 = sl12</p>
        </div>

        <div>
            <table class="table table-dark table-striped table-hover table-sm" id="table_int">
            </table>
        </div>

        <script>
            $(document).ready(function () {
                $.getJSON($("meta[name=bmstable]").attr("content"), function (header) {
                    $.getJSON(header.data_url, function (information) {
                        makeBMSTable(information, header.symbol);
                    });
                });
            });

            function makeBMSTable(info, mark) {
                var x = "";
                var count = 0;
                var obj = $("#table_int");

                obj.html("");

                var thead = $("<thead class='table-dark'><tr><th>Level</th><th>Title</th><th>Artist</th><th>BPM</th><th>Notes</th><th>Total</th><th>Song</th><th>Chart</th><th>Comment</th></tr></thead>");
                var tbody = $("<tbody></tbody>");

                thead.appendTo(obj);
                tbody.appendTo(obj);

                var obj_sep = null;

                for (var i = 0; i < info.length; i++) {

                    if (x != info[i].level) {
                        if (obj_sep != null) {
                            obj_sep.html("<td colspan='9'><b>" + mark + x + " (" + count + "譜面)</b></td>");
                        }

                        obj_sep = $("<tr class='level-sep'></tr>");
                        obj_sep.appendTo(tbody);

                        count = 0;
                        x = info[i].level;
                    }

                    var str = $("<tr></tr>");

                    $("<td width='5%'>" + mark + x + "</td>").appendTo(str);

                    $("<td width='30%'><a href='http://www.dream-pro.info/~lavalse/LR2IR/search.cgi?mode=ranking&bmsmd5=" +
                        info[i].md5 + "' target='_blank'>" + info[i].title + "</a></td>").appendTo(str);

                    $("<td width='13%'>" + info[i].artist + "</td>").appendTo(str);
                    $("<td width='7%'>" + info[i].bpm + "</td>").appendTo(str);
                    $("<td width='5%'>" + info[i].notes + "</td>").appendTo(str);
                    $("<td width='5%'>" + info[i].total + "</td>").appendTo(str);

                    $("<td width='5%'><a href='" + info[i].url + "' target='_blank'>DL</a></td>").appendTo(str);

                    $("<td width='5%'>" +
                        (info[i].url_diff && info[i].url_diff.trim() !== ""
                            ? "<a href='" + info[i].url_diff + "' target='_blank'>DL</a>"
                            : "") +
                        "</td>").appendTo(str);

                    var diff = info[i].table;
                    var commentText = info[i].comment || "";

                    var finalComment = "";

                    if (diff && diff.trim() !== "") {
                        finalComment += "[<span class='comment-tag'>" + diff + "</span>] ";
                    }

                    finalComment += commentText;

                    $("<td width='25%'>" + finalComment + "</td>").appendTo(str);

                        str.appendTo(tbody);
                        count++;
                    }

                if (obj_sep != null) {
                    obj_sep.html("<td colspan='9'><b>" + mark + x + " (" + count + "譜面)</b></td>");
                }
            }
        </script>
    </div>

</body>

</html>
